<!-- Top Navbar Component -->
<app-navbar [role]="role" [isLoggedIn]="isLoggedIn" (logoutEvent)="logout()"></app-navbar>

<!-- Main Layout -->
<div class="flex min-h-screen bg-gray-100">

  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-lg p-6 flex flex-col">
    <h6 class="text-xl font-bold mb-6 text-blue-600 flex items-center gap-2">ğŸ“‚ Navigation</h6>
    <nav class="flex flex-col gap-3">
      <ul class="nav flex-column gap-2">
        <li class="nav-item">
          <a class="nav-link text-dark fw-semibold" routerLink="/dashboard" routerLinkActive="active">ğŸ  Dashboard</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark fw-semibold" routerLink="/reports" routerLinkActive="active">ğŸ“Š Reports</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark fw-semibold" routerLink="/feedback" routerLinkActive="active">ğŸ“ Feedback</a>
        </li>
        <li class="nav-item" *ngIf="role === 'SA'">
          <a class="nav-link text-dark fw-semibold" routerLink="/app" routerLinkActive="active">ğŸ“± Mobile App</a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Content Area -->
  <main class="flex-1 p-6 space-y-6">

    <!-- Overview Header -->
    <h5 class="text-2xl font-bold text-blue-600">ğŸ“± Mobile App Management</h5>

    <!-- Current App Info -->
    <div class="bg-white p-5 rounded-2xl shadow-lg space-y-3">
      <h6 class="text-lg font-semibold text-gray-700">Current Version</h6>
      <p><strong>Version:</strong> {{ app.version }}</p>
      <p>
        <strong>Download APK:</strong>
        <a [href]="app.apk_url" target="_blank" class="text-blue-600 underline">{{ app.apk_url }}</a>
      </p>
    </div>

    <!-- Upload New Version -->
    <div class="bg-white p-5 rounded-2xl shadow-lg space-y-3">
      <h6 class="text-lg font-semibold text-gray-700">Upload New Version</h6>
      <form (ngSubmit)="uploadNewVersion()">
        <div class="flex flex-col md:flex-row gap-3 items-center">
          <input type="file" (change)="onFileSelected($event)" accept=".apk"
                 class="border rounded px-3 py-2 w-full md:w-auto" [disabled]="loading">
          <input type="text" [(ngModel)]="newVersion" name="version" placeholder="Version (e.g., 3.1.0)"
                 class="border rounded px-3 py-2 w-full md:w-1/3" [disabled]="loading">
          <button type="submit"
                  class="px-5 py-2 bg-green-600 hover:bg-green-700 text-white rounded-full shadow-md"
                  [disabled]="loading">
            Upload
          </button>
        </div>

        <!-- Spinner Loader -->
        <div *ngIf="loading" class="mt-3 flex items-center gap-2">
          <div class="w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
          <span class="text-blue-600 font-semibold">Uploading...</span>
        </div>

        <!-- Optional Progress Bar -->
        <div *ngIf="uploadProgress >= 0" class="mt-3 w-full bg-gray-200 rounded-full h-4">
          <div class="bg-blue-500 h-4 rounded-full" [style.width.%]="uploadProgress"></div>
        </div>
      </form>
    </div>

    <!-- App Version History -->
    <div class="bg-white p-5 rounded-2xl shadow-lg space-y-3">
      <h6 class="text-lg font-semibold text-gray-700">Version History</h6>
      <table class="min-w-full divide-y divide-gray-200 text-sm">
        <thead class="bg-gray-50">
          <tr class="text-left font-semibold">
            <th class="px-4 py-2">Version</th>
            <th class="px-4 py-2">APK URL</th>
            <th class="px-4 py-2">Uploaded At</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-300">
          <tr *ngFor="let item of appHistory">
            <td class="px-4 py-2">{{ item.version }}</td>
            <td class="px-4 py-2">
              <a [href]="item.apk_url" target="_blank" class="text-blue-600 underline">{{ item.apk_url }}</a>
            </td>
            <td class="px-4 py-2">{{ item.uploadedAt | date:'medium' }}</td>
          </tr>
        </tbody>
      </table>
      <p *ngIf="appHistory.length === 0" class="text-gray-400 py-2">No previous versions found.</p>
    </div>

  </main>
</div>
