<!-- Make the entire container draggable -->
<div
  class="incident-container mat-elevation-z4 p-6 rounded-xl bg-white shadow-lg max-w-4xl mx-auto cursor-move"
  cdkDrag
  cdkDragRootElement=".cdk-overlay-pane"
>

  <!-- Drag Handle (only drag by this header) -->
  <div class="drag-handle flex items-center gap-2 mb-4" cdkDragHandle>
    <mat-icon>drag_handle</mat-icon>
    <span class="font-semibold text-lg">Incident Details</span>
  </div>

  <!-- Search Section -->
  <div class="search-section flex flex-col sm:flex-row gap-4 mb-6 items-center">

  <!-- Search Input -->
  <mat-form-field class="flex-1 w-full">
    <mat-label class="text-gray-700 font-medium">Search Incident by ID / Index</mat-label>
    <input
      matInput
      [(ngModel)]="searchId"
      placeholder="Enter Incident ID or Number"
      class="rounded-lg border border-gray-300 text-gray-700 px-3 py-2 focus:border-blue-500 focus:ring focus:ring-blue-100"
    >
    <button
      *ngIf="searchId"
      matSuffix
      mat-icon-button
      aria-label="Clear"
      (click)="searchId=''; item=null"
      class="text-blue-500 hover:text-black-700"
    >
      <mat-icon>close</mat-icon>
    </button>
  </mat-form-field>

  <!-- Search Button -->
  <button
    mat-raised-button
    (click)="findIncidentById()"
    class="flex items-center gap-2 px-5 py-3 bg-blue-600 hover:bg-blue-700 text-black font-semibold rounded-lg shadow transition transform hover:-translate-y-1"
  >
    <mat-icon>search</mat-icon>
    Search
  </button>

</div>

  <!-- Incident Card -->
  <mat-card *ngIf="item" class="incident-card grid grid-cols-1 sm:grid-cols-3 gap-4 p-4">

    <!-- Left: Media Thumbnail (keep image size) -->
    <div class="media-container col-span-1 flex justify-center items-center">
      <a *ngIf="item?.media_url"
         [href]="item?.media_url"
         target="_blank"
         rel="noopener noreferrer"
         class="thumbnail-link">
        <img [src]="item?.media_url" alt="Incident media">
      </a>
      <div *ngIf="!item?.media_url" class="text-gray-400 flex items-center justify-center h-full">
        <mat-icon class="text-4xl">image_not_supported</mat-icon>
        <span class="ml-2">No Media</span>
      </div>
    </div>

    <!-- Right: Details and Actions -->
    <div class="col-span-2 flex flex-col justify-between">

      <!-- Header -->
      <div class="flex items-center gap-4 mb-4">
        <div class="incident-avatar bg-blue-100 rounded-full w-12 h-12 flex items-center justify-center">
          <mat-icon color="primary">report</mat-icon>
        </div>
        <div>
          <h3 class="text-lg font-semibold">{{ item?.accident_type?.join(', ') || 'Unknown Type' }}</h3>
          <p class="text-sm text-gray-500">
            Status: <span class="font-medium">{{ item?.status }}</span>
          </p>
        </div>
      </div>

      <!-- Content -->
      <div class="incident-content mb-4 text-gray-700">
        <p><strong>Date:</strong> {{ item?.timestamp | date:'medium' }}</p>
        <p><strong>Latitude:</strong> {{ item?.latitude }}</p>
        <p><strong>Longitude:</strong> {{ item?.longitude }}</p>
      </div>

      <!-- Actions -->
      <div class="incident-actions flex flex-wrap gap-3 mt-4">
        <ng-container *ngFor="let r of item?.flag">
          <button
            *ngIf="r !== role"
            mat-stroked-button
            color="accent"
            class="flex-1 sm:flex-none"
            (click)="request(r)">
            Request {{ r }}
          </button>
        </ng-container>

        <button mat-stroked-button color="warn" class="flex-1 sm:flex-none" (click)="close()">
          Cancel
        </button>
      </div>

    </div>
  </mat-card>

  <!-- No Results Message -->
  <div *ngIf="!item && searchId" class="text-center mt-8 text-gray-500 flex flex-col items-center gap-2">
    <mat-icon color="warn" class="text-4xl">info</mat-icon>
    <p class="text-lg">No incident found for the given ID.</p>
  </div>

</div>
